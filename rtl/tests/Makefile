

# folders (do NOT include end slash)
LOGS_FOLDER = logs
VCS_FOLDER = vcs

BASE = ..#../pre_ls_spec_rtl
# Files necessary for simulation of module testbench
OOO_TOP_FILES          = $(BASE)/data_types.sv $(BASE)/OoO_top.sv \
						 $(BASE)/fifo.sv \
						 $(BASE)/shifter.sv \
						 $(BASE)/res_station.sv \
						 $(BASE)/regfile.sv \
						 $(BASE)/priority_encoder.sv \
						 $(BASE)/alu.sv \
						 $(BASE)/broadcast_cdb.sv \
						 $(BASE)/issue_logic.sv \
						 $(BASE)/basic_dmem_model.sv \
						 $(BASE)/load_store_unit.sv \
						 $(BASE)/dmem_read_write_unit.sv \
						 $(BASE)/branch_unit.sv \
						 $(BASE)/branch_pred.sv \
						 $(BASE)/instr_fetch_unit.sv \
						 ./OoO_top_tb.sv

FIFO_FILES             = ../data_types.sv ../fifo.sv ./fifo_tb.sv
SHIFTER_FILES          = ../data_types.sv ../shifter.sv ./shifter_tb.sv
RES_STATION_FILES      = $(BASE)/data_types.sv $(BASE)/res_station.sv ./res_station_tb.sv
REGFILE_FILES          = ../data_types.sv ../regfile.sv ./regfile_tb.sv
PRIORITY_ENCODER_FILES = ../data_types.sv ../priority_encoder.sv ./priority_encoder_tb.sv
ALU_FILES              = ../data_types.sv ../alu.sv ./alu_tb.sv
BROADCAST_CDB_FILES    = ../data_types.sv ../broadcast_cdb.sv ./broadcast_cdb_tb.sv ../priority_encoder.sv
RS_MONITOR_FILES       = ../data_types.sv ../rs_monitor.sv ./rs_monitor_tb.sv ../priority_encoder.sv
INSTRUC_DECODE_FILES   = ../data_types.sv ../instruc_decode.sv ./instruc_decode_tb.sv
BASIC_DMEM_MODEL_FILES = ../data_types.sv ../basic_dmem_model.sv ./basic_dmem_model_tb.sv
LOAD_STORE_UNIT_FILES  = ../data_types.sv ../load_store_unit.sv ../dmem_read_write_unit.sv ../basic_dmem_model.sv ./load_store_unit_tb.sv
#ISSUE_LOGIC_FILES  	   = ../data_types.sv ../fifo.sv ../priority_encoder.sv ../regfile.sv ../rs_monitor.sv ../instruc_decode.sv ../issue_logic.sv ./issue_logic_tb.sv 

ISSUE_LOGIC_FILES  	   = $(BASE)/data_types.sv $(BASE)/fifo.sv $(BASE)/priority_encoder.sv $(BASE)/regfile.sv $(BASE)/issue_logic.sv ./issue_logic_tb.sv 
DMEM_READ_WRITE_UNIT_FILES = ../data_types.sv ./dmem_read_write_unit_tb.sv ../dmem_read_write_unit.sv
INSTR_FETCH_PRED_FILES = ../data_types.sv ../instr_fetch_unit.sv ../branch_pred.sv ../fifo.sv ./instr_fetch_br_pred_tb.sv

# files generated by vcs that we dont want cluttering things
VCS_FILES_TO_CLEAN = csrc simv simv.daidir ucli.key

# anything that may need to be updated/generated
TARGETS = $(LOGS_FOLDER) \
		  $(VCS_FOLDER) \
		  $(VCS_FOLDER)/fifo.vpd \
		  $(VCS_FOLDER)/res_station.vpd \
		  $(VCS_FOLDER)/priority_encoder.vpd \
		  $(VCS_FOLDER)/alu.vpd \
		  $(VCS_FOLDER)/priority_encoder.vpd \
		  $(VCS_FOLDER)/broadcast_cdb.vpd \
		  $(VCS_FOLDER)/load_store_unit.vpd \
		  $(VCS_FOLDER)/basic_dmem_model.vpd \
		  $(VCS_FOLDER)/dmem_read_write_unit.vpd \
		  $(VCS_FOLDER)/OoO_top.vpd    \
		  $(VCS_FOLDER)/rs_monitor.vpd \
	      $(VCS_FOLDER)/shifter.vpd \
		  $(VCS_FOLDER)/regfile.vpd \
		  $(VCS_FOLDER)/rs_monitor.vpd	 \
		  $(VCS_FOLDER)/instr_fetch_br_pred.vpd	 \
		  $(VCS_FOLDER)/instruc_decode.vpd \
		  $(VCS_FOLDER)/issue_logic.vpd

all: $(TARGETS)


# simulation entries
$(VCS_FOLDER)/OoO_top.vpd: $(OOO_TOP_FILES)
	vcs $(OOO_TOP_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/rs_monitor.vpd: $(RS_MONITOR_FILES)
	vcs $(RS_MONITOR_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/fifo.vpd: $(FIFO_FILES)
	vcs $(FIFO_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/basic_dmem_model.vpd: $(BASIC_DMEM_MODEL_FILES)
	vcs $(BASIC_DMEM_MODEL_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/load_store_unit.vpd: $(LOAD_STORE_UNIT_FILES)
	vcs $(LOAD_STORE_UNIT_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/dmem_read_write_unit.vpd: $(DMEM_READ_WRITE_UNIT_FILES)
	vcs $(DMEM_READ_WRITE_UNIT_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/shifter.vpd: $(SHIFTER_FILES)
#	vcs $(SHIFTER_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/res_station.vpd: $(RES_STATION_FILES)
	vcs $(RES_STATION_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/regfile.vpd: $(REGFILE_FILES)
#	vcs $(REGFILE_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/priority_encoder.vpd: $(PRIORITY_ENCODER_FILES)
	vcs $(PRIORITY_ENCODER_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/alu.vpd: $(ALU_FILES)
	vcs $(ALU_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/broadcast_cdb.vpd: $(BROADCAST_CDB_FILES)
	vcs $(BROADCAST_CDB_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)


$(VCS_FOLDER)/instruc_decode.vpd: $(INSTRUC_DECODE_FILES)
	vcs $(INSTRUC_DECODE_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/issue_logic.vpd: $(ISSUE_LOGIC_FILES)
	vcs $(ISSUE_LOGIC_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/instr_fetch_br_pred.vpd: $(INSTR_FETCH_PRED_FILES)
	vcs $(INSTR_FETCH_PRED_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(LOGS_FOLDER):
	mkdir $@

$(VCS_FOLDER):
	mkdir $@


.PHONY: issue clean shifter res enc alu monitor decode fifo top fetch
clean:
	rm $(LOGS_FOLDER)/* $(VCS_FOLDER)/*

shifter: $(VCS_FOLDER)/shifter.vpd
res: 	 $(VCS_FOLDER)/res_station.vpd
regfile: $(VCS_FOLDER)/regfile.vpd
enc:     $(VCS_FOLDER)/priority_encoder.vpd
alu:	 $(VCS_FOLDER)/alu.vpd
monitor: $(VCS_FOLDER)/rs_monitor.vpd
decode:  $(VCS_FOLDER)/instruc_decode.vpd
issue:   $(VCS_FOLDER)/issue_logic.vpd
fifo:    $(VCS_FOLDER)/fifo.vpd
top:     $(VCS_FOLDER)/OoO_top.vpd
fetch:	 $(VCS_FOLDER)/instr_fetch_br_pred.vpd
