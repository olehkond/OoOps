

# folders (do NOT include end slash)
LOGS_FOLDER = logs
VCS_FOLDER = vcs

BASE = ..#../pre_ls_spec_rtl
# Files necessary for simulation of module testbench
OOO_TOP_FILES          = $(BASE)/data_types.sv $(BASE)/OoO_top.sv \
						 $(BASE)/fifo.sv \
						 $(BASE)/shifter.sv \
						 $(BASE)/res_station.sv \
						 $(BASE)/regfile.sv \
						 $(BASE)/priority_encoder.sv \
						 $(BASE)/alu.sv \
						 $(BASE)/broadcast_cdb.sv \
						 $(BASE)/issue_logic.sv \
						 $(BASE)/basic_dmem_model.sv \
						 $(BASE)/load_store_unit.sv \
						 $(BASE)/dmem_read_write_unit.sv \
						 $(BASE)/branch_unit.sv \
						 $(BASE)/branch_pred.sv \
						 $(BASE)/instr_fetch_unit.sv \
						 ./OoO_top_tb.sv

FIFO_FILES             = ../data_types.sv ../fifo.sv ./fifo_tb.sv
#SHIFTER_FILES          = ../data_types.sv ../shifter.sv ./shifter_tb.sv
#RES_STATION_FILES      = $(BASE)/data_types.sv $(BASE)/res_station.sv ./res_station_tb.sv
#REGFILE_FILES          = ../data_types.sv ../regfile.sv ./regfile_tb.sv
PRIORITY_ENCODER_FILES = ../data_types.sv ../priority_encoder.sv ./priority_encoder_tb.sv
#ALU_FILES              = ../data_types.sv ../alu.sv ./alu_tb.sv
BROADCAST_CDB_FILES    = ../data_types.sv ../broadcast_cdb.sv ./broadcast_cdb_tb.sv ../priority_encoder.sv
BASIC_DMEM_MODEL_FILES = ../data_types.sv ../basic_dmem_model.sv ./basic_dmem_model_tb.sv
#LOAD_STORE_UNIT_FILES  = ../data_types.sv ../load_store_unit.sv ../dmem_read_write_unit.sv ../basic_dmem_model.sv ./load_store_unit_tb.sv
#ISSUE_LOGIC_FILES  	   = ../data_types.sv ../fifo.sv ../priority_encoder.sv ../regfile.sv ../rs_monitor.sv ../instruc_decode.sv ../issue_logic.sv ./issue_logic_tb.sv 

ISSUE_LOGIC_FILES  	   = $(BASE)/data_types.sv $(BASE)/fifo.sv $(BASE)/priority_encoder.sv $(BASE)/regfile.sv $(BASE)/issue_logic.sv ./issue_logic_tb.sv 
#DMEM_READ_WRITE_UNIT_FILES = ../data_types.sv ./dmem_read_write_unit_tb.sv ../dmem_read_write_unit.sv
#INSTR_FETCH_PRED_FILES = ../data_types.sv ../instr_fetch_unit.sv ../branch_pred.sv ../fifo.sv ./instr_fetch_br_pred_tb.sv

# files generated by vcs that we dont want cluttering things
VCS_FILES_TO_CLEAN = csrc simv simv.daidir ucli.key

# anything that may need to be updated/generated
TARGETS = $(LOGS_FOLDER) \
		  $(VCS_FOLDER) \
		  $(VCS_FOLDER)/fifo.vpd \
		  $(VCS_FOLDER)/priority_encoder.vpd \
		  $(VCS_FOLDER)/alu.vpd \
		  $(VCS_FOLDER)/priority_encoder.vpd \
		  $(VCS_FOLDER)/broadcast_cdb.vpd \
		  $(VCS_FOLDER)/basic_dmem_model.vpd \
		  $(VCS_FOLDER)/OoO_top.vpd    \

#		  $(VCS_FOLDER)/issue_logic.vpd
#		  $(VCS_FOLDER)/res_station.vpd \
#		  $(VCS_FOLDER)/load_store_unit.vpd \
#	      $(VCS_FOLDER)/shifter.vpd \
#		  $(VCS_FOLDER)/regfile.vpd \
#		  $(VCS_FOLDER)/dmem_read_write_unit.vpd \

all: $(TARGETS)


# simulation entries
$(VCS_FOLDER)/OoO_top.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(OOO_TOP_FILES)
	vcs $(OOO_TOP_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/fifo.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(FIFO_FILES)
	vcs $(FIFO_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/basic_dmem_model.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(BASIC_DMEM_MODEL_FILES)
	vcs $(BASIC_DMEM_MODEL_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/load_store_unit.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(LOAD_STORE_UNIT_FILES)
#	vcs $(LOAD_STORE_UNIT_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/dmem_read_write_unit.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(DMEM_READ_WRITE_UNIT_FILES)
#	vcs $(DMEM_READ_WRITE_UNIT_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/shifter.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(SHIFTER_FILES)
#	vcs $(SHIFTER_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/res_station.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(RES_STATION_FILES)
#	vcs $(RES_STATION_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/regfile.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(REGFILE_FILES)
#	vcs $(REGFILE_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/priority_encoder.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(PRIORITY_ENCODER_FILES)
	vcs $(PRIORITY_ENCODER_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/alu.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(ALU_FILES)
#	vcs $(ALU_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

$(VCS_FOLDER)/broadcast_cdb.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(BROADCAST_CDB_FILES)
	vcs $(BROADCAST_CDB_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)


$(VCS_FOLDER)/issue_logic.vpd: $(LOGS_FOLDER) $(VCS_FOLDER) $(ISSUE_LOGIC_FILES)
	vcs $(ISSUE_LOGIC_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
	mv vcdplus.vpd $@
	rm -r $(VCS_FILES_TO_CLEAN)

#$(VCS_FOLDER)/instr_fetch_br_pred.vpd: $(INSTR_FETCH_PRED_FILES)
#	vcs $(INSTR_FETCH_PRED_FILES) +v2k -R +lint=all -sverilog -full64 -debug_pp -timescale=1ns/10ps -l $(subst $(VCS_FOLDER),$(LOGS_FOLDER), $@).log
#	mv vcdplus.vpd $@
#	rm -r $(VCS_FILES_TO_CLEAN)

$(LOGS_FOLDER):
	mkdir $@

$(VCS_FOLDER):
	mkdir $@


.PHONY: clean enc fifo top
clean:
	-rm $(LOGS_FOLDER)/* $(VCS_FOLDER)/*.vpd $(VCS_FOLDER)/sessions/*

enc:     $(VCS_FOLDER)/priority_encoder.vpd
fifo:    $(VCS_FOLDER)/fifo.vpd
top:     $(VCS_FOLDER)/OoO_top.vpd
